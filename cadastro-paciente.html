<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cadastrar Paciente</title>

  <link rel="stylesheet" href="./css/global.css">
</head>
<body>

  <!-- HEADER -->
  <div class="header">
    <h2>Novo Paciente</h2>
    <span class="jackt">Jackt Lab</span>
  </div>

  <div class="card" style="max-width:520px; margin:auto;">

    <label>Nome completo</label>
    <input type="text" id="nome">

    <label>CPF</label>
    <input type="text" id="cpf">

    <label>Telefone</label>
    <input type="text" id="telefone">

    <label>Email</label>
    <input type="email" id="email">

    <label>Data de nascimento</label>
    <input type="date" id="dataNascimento">

    <div style="display:flex; gap:12px; justify-content:flex-end; margin-top:16px;">
      <button id="voltar" style="background:#e5e7eb; color:#111;">Voltar</button>
      <button id="salvar">Salvar Paciente</button>
    </div>

    <p id="msg" style="margin-top:12px; color:var(--muted);"></p>
  </div>

  <script type="module">
    import { supabase } from './js/supabase.js'
    import { protegerPagina } from './js/auth.js'

    await protegerPagina()

    const msg = document.getElementById('msg')

    document.getElementById('salvar').onclick = async () => {
      const paciente = {
        nome: document.getElementById('nome').value,
        cpf: document.getElementById('cpf').value,
        telefone: document.getElementById('telefone').value,
        email: document.getElementById('email').value,
        data_nascimento: document.getElementById('dataNascimento').value
      }

      if (!paciente.nome) {
        msg.textContent = 'Informe o nome do paciente'
        return
      }

      msg.textContent = 'Salvando paciente...'

      const { error } = await supabase
        .from('paciente')
        .insert(paciente)

      if (error) {
        msg.textContent = error.message
        console.error(error)
      } else {
        window.location.href = 'atendimento.html'
      }
    }

    document.getElementById('voltar').onclick = () => {
      history.back()
    }
  </script>

</body>
</html>
